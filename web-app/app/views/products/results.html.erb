<%= render "/partials/header" %>

<div class="container">
	<div class= "col-lg-12">
		<div class="page-header">
			<h2>Results 
				<% if !@results['numFound'].nil? %>
					<small><%= @results['numFound'] %> found</small>
				<% end %>
			</h2>
		</div>

		<!-- BEGIN RESULTS AND FILTERS -->
		<% if !@results['productSearchEntry'].nil? %>

			<!-- BEGIN FILTERS -->
			<% if !@results['facetAttribute'].nil? %>	
				<div class="col-lg-3">
					<div class="panel panel-default">
						<div class="panel-heading">
							Filter your results
						</div>
						<div class="panel-body" id="filter-panel">
								
							<% @results['facetAttribute'].each do |facet| %>
								<div data-facet-container="<%= facet['name'] %>">
									<p><strong><%= facet['name'] %></strong></p>
									<% if params[facet['name'].downcase + 'Filter'].nil? #Really janky way of checking for facetFilter=...%>
										<% facet['facet'].each do |facetValue| %>
											<div class="checkbox">
												<label>
													<input data-facet-field="<%= facet['name'] %>" data-facet-value="<%= facetValue['name'] %>" type="checkbox">
														<%= facet['name'] == "Rating"? facetValue['name'] + "+" : facetValue['name'] %> (<%= facetValue['numFound'] %>)
												</label>
											</div>
										<% end #facet.each do %>
									<% else #facetFilter isn't nil, meaning it's activated; provide a way to go back %>
										<p>Showing only <%= params[facet['name'].downcase + 'Filter'] %></p>
										<p><button class="btn btn-default btn-block">Show all</button></p>
										<% #note: this button does nothing currently. We should make it do something. %>
									<% end #facetFilter%>	
								</div>

							<% end %>

						</div>
					</div>
				</div>
			<% end %>
			<!-- END FILTERS -->

			<!-- BEGIN RESULTS -->
			<div class="col-lg-9">
				<% @results['productSearchEntry'].each do |result| %>
					<div class="col-lg-4">
						<div class="thumbnail">
							<% %>
							<div class="caption">
								<h5><%= link_to(result['title'], "products/#{result['pid']}") %></h5>
							</div>
						</div>
					</div>
				<% end %>
<%
=begin
%>
THIS ISN'T WORKING YET!!
<!-- BEGIN PAGINATION -->
				<div>
					<% if !@results['numFound'].nil? %>
						<ul class="pagination">
							<li class="disabled"><a href="#">&laquo;</a></li>

							<% for i in @start..@end %>
								<% if i == @current %>
		  							<li class="current"><a href="#"><%= i %></a></li>
		  						<% else %>
		  							<li><a href="#"><%= i %></a></li>
		  						<% end %>
		  					<% end %>

		  					<li><a href="#">&raquo;</a></li>
				 		</ul>

					<% end %>
				</div>
				<!-- END PAGINATION -->
<%
=end 
%>

			</div>
			<!-- END RESULTS -->	

		<% else %>
			<div class="alert alert-warning col-lg-8 col-lg-offset-2">
				<p class="text-center">No results found</p>	
			</div>
		<% end %> 
		<!-- END RESULTS AND FILTERS -->
	</div>
</div>

<script>
var catFilter = new Filter($("div[data-facet-container='Category']"), "categoryFilter", "categories");

var ratingFilter = new Filter($("div[data-facet-container='Rating']"), "ratingFilter", "ratings");

</script>

<%= render "/partials/footer" %>